define("bui-uploader/1.1.0/index",["jquery","bui-common/1.1.0/common","bui-uploader/1.1.0/src/uploader","bui-uploader/1.1.0/src/queue","bui-uploader/1.1.0/src/theme","bui-uploader/1.1.0/src/factory","bui-uploader/1.1.0/src/file","bui-uploader/1.1.0/src/validator","bui-uploader/1.1.0/src/button/htmlButton","bui-uploader/1.1.0/src/button/swfButton","bui-uploader/1.1.0/src/type/ajax","bui-uploader/1.1.0/src/type/flash","bui-uploader/1.1.0/src/type/iframe","bui-data/1.1.0/index","bui-list/1.1.0/index","bui-uploader/1.1.0/src/button/base","bui-uploader/1.1.0/src/button/filter","bui-uploader/1.1.0/src/button/ajbridge","bui-swf/1.1.0/index","bui-uploader/1.1.0/src/type/base"],function(e,t,r){var i=e("bui-common/1.1.0/common"),u=i.namespace("Uploader");i.mix(u,{Uploader:e("bui-uploader/1.1.0/src/uploader"),Queue:e("bui-uploader/1.1.0/src/queue"),Theme:e("bui-uploader/1.1.0/src/theme"),Factory:e("bui-uploader/1.1.0/src/factory")}),r.exports=u}),define("bui-uploader/1.1.0/src/uploader",["jquery","bui-common/1.1.0/common","bui-uploader/1.1.0/src/file","bui-uploader/1.1.0/src/theme","bui-uploader/1.1.0/src/factory","bui-uploader/1.1.0/src/validator","bui-uploader/1.1.0/src/queue","bui-uploader/1.1.0/src/button/htmlButton","bui-uploader/1.1.0/src/button/swfButton","bui-uploader/1.1.0/src/type/ajax","bui-uploader/1.1.0/src/type/flash","bui-uploader/1.1.0/src/type/iframe","bui-data/1.1.0/index","bui-list/1.1.0/index","bui-uploader/1.1.0/src/button/base","bui-uploader/1.1.0/src/button/filter","bui-uploader/1.1.0/src/button/ajbridge","bui-swf/1.1.0/index","bui-uploader/1.1.0/src/type/base"],function(e,t,r){function i(e){return p[e]&&p[e]()}function u(e,t,r){a.isFunction(e.set)?e.set(t,r):e[t]=r}var n=e("jquery"),a=e("bui-common/1.1.0/common"),o=a.Component,s=e("bui-uploader/1.1.0/src/file"),l=e("bui-uploader/1.1.0/src/theme"),c=e("bui-uploader/1.1.0/src/factory"),d=e("bui-uploader/1.1.0/src/validator"),p={ajax:function(){return!!window.FormData},flash:function(){return!0},iframe:function(){return!0}},f=o.Controller.extend({initializer:function(){var e=this;e._initTheme(),e._initType()},renderUI:function(){var e=this;e._renderButton(),e._renderUploaderType(),e._renderQueue(),e._initValidator()},bindUI:function(){var e=this;e._bindButton(),e._bindUploaderCore(),e._bindQueue()},_initTheme:function(){var e=this,t=l.getTheme(e.get("theme")),r=e.getAttrVals();a.each(t,function(t,i){void 0===r[i]?e.set(i,t):n.isPlainObject(t)&&(a.mix(t,r[i]),e.set(i,t))})},_initType:function(){var e=this,t=e.get("types"),r=e.get("type");r||a.each(t,function(e){return i(e)?(r=e,!1):void 0}),e.set("type",r)},_initValidator:function(){var e=this,t=e.get("validator");t||(t=new d({queue:e.get("queue"),rules:e.get("rules")}),e.set("validator",t))},_renderUploaderType:function(){var e=this,t=e.get("type"),r=e.get("uploaderType"),i=c.createUploadType(t,r);i.set("uploader",e),e.set("uploaderType",i)},_renderButton:function(){var e=this,t=e.get("type"),r=e.get("el"),i=e.get("button");i.isController||(i.render=r,i.autoRender=!0,i=c.createButton(t,i),e.set("button",i)),i.set("uploader",e)},_renderQueue:function(){var e=this,t=e.get("el"),r=e.get("queue");r.isController||(r.render=t,r.autoRender=!0,r=c.createQueue(r),e.set("queue",r)),r.set("uploader",e)},_bindButton:function(){var e=this,t=e.get("button"),r=e.get("queue");t.on("change",function(t){var i=t.files;r.addItems(i),e.fire("change",{items:i})})},_bindQueue:function(){var e=this,t=e.get("queue"),r=(e.get("button"),e.get("validator"));t.on("itemrendered",function(i){var u=i.item,n=t.status(u)||"add";u.isUploaderFile||(u.result=a.cloneObject(u),u=s.create(u)),r.valid(u)||(n="error"),t.updateFileStatus(u,n),e.get("autoUpload")&&e.upload()}),t.on("itemupdated",function(){e.uploadFiles()})},_bindUploaderCore:function(){var e=this,t=e.get("queue"),r=e.get("uploaderType");r.on("start",function(t){var r=t.file;delete r.result,e.fire("start",{item:r})}),r.on("progress",function(r){var i=e.get("curUploadItem"),u=r.loaded,n=r.total;a.mix(i,{total:n,loaded:u,loadedPercent:100*u/n}),t.updateFileStatus(i,"progress"),e.fire("progress",{item:i,total:n,loaded:u})}),r.on("error",function(){var r=e.get("curUploadItem"),i=e.get("error"),u=e.get("complete");t.updateFileStatus(r,"error"),i&&a.isFunction(i)&&i.call(e),e.fire("error",{item:r}),u&&a.isFunction(u)&&u.call(e),e.fire("complete",{item:r}),e.set("curUploadItem",null)}),r.on("complete",function(r){var i=e.get("curUploadItem"),u=r.result,n=e.get("isSuccess"),o=e.get("success"),s=e.get("error"),l=e.get("complete");e.set("curUploadItem",null),i.result=u,n.call(e,u)?(a.mix(i,u),t.updateFileStatus(i,"success"),o&&a.isFunction(o)&&o.call(e,u),e.fire("success",{item:i,result:u})):(t.updateFileStatus(i,"error"),s&&a.isFunction(s)&&s.call(e,u),e.fire("error",{item:i,result:u})),l&&a.isFunction(l)&&l.call(e,u),e.fire("complete",{item:i,result:u})})},uploadFile:function(e){var t=this,r=t.get("queue"),i=t.get("uploaderType"),u=t.get("curUploadItem");e&&!u&&(t.set("curUploadItem",e),r.updateFileStatus(e,"start"),i.upload(e))},uploadFiles:function(){var e=this,t=e.get("queue"),r=t.getItemsByStatus("wait");r&&r.length&&e.uploadFile(r[0])},upload:function(){var e=this,t=e.get("queue"),r=t.getItemsByStatus("add");a.each(r,function(e){t.updateFileStatus(e,"wait")})},cancel:function(e){var t=this;return e?void t._cancel(e):void a.each(t.get("queue").getItemsByStatus("wait"),function(e){t._cancel(e)})},_cancel:function(e){var t=this,r=t.get("queue"),i=t.get("uploaderType"),u=t.get("curUploadItem");u===e&&(i.cancel(),t.set("curUploadItem",null)),r.updateFileStatus(e,"cancel"),t.fire("cancel",{item:e})},isValid:function(){var e=this,t=e.get("queue");return t.getItemsByStatus("success").length===t.getItems().length}},{ATTRS:{types:{value:["ajax","flash","iframe"]},type:{},theme:{value:"default"},button:{value:{},shared:!1},text:{setter:function(e){return u(this.get("button"),"text",e),e}},name:{setter:function(e){return u(this.get("button"),"name",e),u(this.get("uploaderType"),"fileDataName",e),e}},disabled:{value:!1,setter:function(e){return u(this.get("button"),"disabled",e),e}},multiple:{value:!0,setter:function(e){return u(this.get("button"),"multiple",e),e}},filter:{setter:function(e){return u(this.get("button"),"filter",e),e}},uploaderType:{value:{},shared:!1},url:{setter:function(e){return u(this.get("uploaderType"),"url",e),e}},data:{setter:function(e){return u(this.get("uploaderType"),"data",e),e}},queue:{value:{},shared:!1},resultTpl:{setter:function(e){return u(this.get("queue"),"resultTpl",e),e}},autoUpload:{value:!0},uploadStatus:{},isSuccess:{value:function(e){return e&&e.url?!0:!1}},validator:{},events:{value:{change:!1,start:!1,progress:!1,success:!1,error:!1,complete:!1,cancel:!1}}}},{xclass:"uploader"});r.exports=f}),define("bui-uploader/1.1.0/src/queue",["jquery","bui-common/1.1.0/common","bui-data/1.1.0/index","bui-list/1.1.0/index"],function(e,t,r){var i=e("jquery"),u=e("bui-common/1.1.0/common"),n=e("bui-list/1.1.0/index").SimpleList,a=u.prefix+"queue",o=a+"-item",s=n.extend({bindUI:function(){var e=this,t=e.get("el"),r=e.get("delCls");t.delegate("."+r,"click",function(t){var r=i(t.target).parents(".bui-queue-item"),u=e.getItemByElement(r);e.fire("beforeremove",{item:u})!==!1&&e.removeItem(u)})},removeItem:function(e){var t=this,r=t.get("uploader");r&&r.cancel&&r.cancel(e),s.superclass.removeItem.call(t,e)},updateFileStatus:function(e,t,r){var i=this,n=i.get("itemStatusFields");r=r||i.findElement(e),u.each(n,function(t,u){i.setItemStatus(e,u,!1,r)}),i.setItemStatus(e,t,!0,r),i._setResultTpl(e,t),i.updateItem(e)},_setResultTpl:function(e,t){var r=this,i=r.get("resultTpl"),n=i[t]||i["default"],a=u.mix(e,e.result);e.resultTpl=u.substitute(n,a)},status:function(e){var t,r=this,i=r.get("itemStatusFields");return u.each(i,function(r){return e[r]?(t=r,!1):void 0}),t}},{ATTRS:{itemTpl:{value:'<li>{resultTpl} <span class="action"><span class="'+o+'-del">删除</span></span></li>'},resultTpl:{value:{"default":'<div class="default">{name}</div>',success:'<div data-url="{url}" class="success">{name}</div>',error:'<div class="error"><span title="{name}">{name}</span><span class="uploader-error">{msg}</span></div>',progress:'<div class="progress"><div class="bar" style="width:{loadedPercent}%"></div></div>'},setter:function(e){return u.mix({},this.get("resultTpl"),e)}},itemCls:{value:o},delCls:{value:o+"-del"},itemStatusFields:{value:{add:"add",wait:"wait",start:"start",progress:"progress",success:"success",cancel:"cancel",error:"error"}}}},{xclass:"queue"});r.exports=s}),define("bui-uploader/1.1.0/src/theme",["jquery","bui-common/1.1.0/common"],function(e,t,r){var i=e("bui-common/1.1.0/common"),u={},n={addTheme:function(e,t){u[e]=t},getTheme:function(e){return i.cloneObject(u[e])}};n.addTheme("default",{elCls:"defaultTheme"}),n.addTheme("imageView",{elCls:"imageViewTheme",queue:{resultTpl:{success:'<div class="success"><img src="{url}" /></div>'}}}),r.exports=n}),define("bui-uploader/1.1.0/src/factory",["jquery","bui-common/1.1.0/common","bui-uploader/1.1.0/src/queue","bui-uploader/1.1.0/src/button/htmlButton","bui-uploader/1.1.0/src/button/swfButton","bui-uploader/1.1.0/src/type/ajax","bui-uploader/1.1.0/src/type/flash","bui-uploader/1.1.0/src/type/iframe","bui-data/1.1.0/index","bui-list/1.1.0/index","bui-uploader/1.1.0/src/file","bui-uploader/1.1.0/src/button/base","bui-uploader/1.1.0/src/button/filter","bui-uploader/1.1.0/src/button/ajbridge","bui-swf/1.1.0/index","bui-uploader/1.1.0/src/type/base"],function(e,t,r){function i(){}var u=(e("bui-common/1.1.0/common"),e("bui-uploader/1.1.0/src/queue")),n=e("bui-uploader/1.1.0/src/button/htmlButton"),a=e("bui-uploader/1.1.0/src/button/swfButton"),o=e("bui-uploader/1.1.0/src/type/ajax"),s=e("bui-uploader/1.1.0/src/type/flash"),l=e("bui-uploader/1.1.0/src/type/iframe");i.prototype={createUploadType:function(e,t){return"ajax"===e?new o(t):"flash"===e?new s(t):new l(t)},createButton:function(e,t){return"ajax"===e||"iframe"===e?new n(t):new a(t)},createQueue:function(e){return new u(e)}},r.exports=new i}),define("bui-uploader/1.1.0/src/file",["jquery","bui-common/1.1.0/common"],function(e,t,r){function i(e){return e.replace(/.*(\/|\\)/,"")}function u(e){var t=/\.[^\.]+$/.exec(e)||[];return t.join("").toLowerCase()}function n(e){var t=-1;do e/=1024,t++;while(e>99);return Math.max(e,.1).toFixed(1)+["KB","MB","GB","TB","PB","EB"][t]}var a=e("bui-common/1.1.0/common");r.exports={create:function(e){return e.id=e.id||a.guid("bui-uploader-file"),e.name=i(e.name),e.ext=u(e.name),e.textSize=n(e.size),e.isUploaderFile=!0,e}}}),define("bui-uploader/1.1.0/src/validator",["jquery","bui-common/1.1.0/common"],function(e,t,r){function i(e){i.superclass.constructor.call(this,e)}var u=e("jquery"),n=e("bui-common/1.1.0/common");i.ATTRS={rules:{},queue:{}},n.extend(i,n.Base),n.augment(i,{valid:function(e){return this._validItem(e)},_validItem:function(e){var t=this,r=t.get("rules"),i=!0;return n.each(r,function(r,u){return i=i&&t._validRule(e,u,r)}),i},_validRule:function(e,t,r,u){n.isArray(r)&&(u=n.substitute(r[1],r),r=r[0]);var a=i.getRule(t),o=a&&a.call(this,e,r,u),s=this._getResult(o);return s?(e.result=s,!1):!0},_getResult:function(e){return e?{msg:e}:void 0}});var a={};i.addRule=function(e,t){a[e]=t},i.getRule=function(e){return a[e]},i.addRule("maxSize",function(e,t,r){return e.size>1024*t?r:void 0}),i.addRule("minSize",function(e,t,r){return e.size<1024*t?r:void 0}),i.addRule("max",function(e,t,r){var i=this.get("queue").getCount();return i>t?r:void 0}),i.addRule("min",function(e,t,r){var i=this.get("queue").getCount();return t>i?r:void 0}),i.addRule("ext",function(e,t,r){var i=e.ext,t=t.split(",");return-1===u.inArray(i,t)?r:void 0}),r.exports=i}),define("bui-uploader/1.1.0/src/button/htmlButton",["jquery","bui-common/1.1.0/common","bui-uploader/1.1.0/src/file","bui-uploader/1.1.0/src/button/base","bui-uploader/1.1.0/src/button/filter"],function(e,t,r){var i=e("jquery"),u=e("bui-common/1.1.0/common"),n=(u.Component,e("bui-uploader/1.1.0/src/file")),a=e("bui-uploader/1.1.0/src/button/base"),o=u.UA,s=a.extend({renderUI:function(){var e=this;e._createInput()},_createInput:function(){var e,t=this,r=t.get("buttonCls"),i=t.get("el").find("."+r),n=t.get("inputTpl"),a=t.get("name");n=u.substitute(n,{name:a}),i.append(n),e=i.find("input"),6==o.ie&&e.css("fontSize","400px"),t._bindChangeHandler(e),t.set("fileInput",e),t._uiSetMultiple(t.get("multiple")),t._uiSetDisabled(t.get("disabled")),t._uiSetFilter(t.get("filter"))},_bindChangeHandler:function(e){var t=this;i(e).on("change",function(r){var a=i(this).val(),o=r.target.files,s=[];o?u.each(o,function(t){s.push(n.create({name:t.name,type:t.type,size:t.size,file:t,input:e}))}):s.push(n.create({name:a,input:e})),t.fire("change",{files:s,input:this}),t.reset()})},reset:function(){var e=this,t=e.get("fileInput");return t.parent().remove(),e.set("fileInput",null),e._createInput(),e},_uiSetMultiple:function(e){var t=this,r=t.get("fileInput");return r&&r.length?(e?r.attr("multiple","multiple"):r.removeAttr("multiple"),e):!1},_uiSetDisabled:function(e){var t=this,r=t.get("fileInput");e?r.hide():r.show()},_uiSetFilter:function(e){var t=this,r=t.get("fileInput"),i=t.getFilter(e);return r&&r.length?(i.type&&r.attr("accept",i.type),i):!1},_uiSetName:function(e){i(this.get("fileInput")).attr("name",e)}},{ATTRS:{inputTpl:{view:!0,value:'<div class="file-input-wrapper"><input type="file" name="{name}" hidefocus="true" class="file-input" /></div>'},fileInput:{}}},{xclass:"uploader-htmlButton"});r.exports=s}),define("bui-uploader/1.1.0/src/button/swfButton",["jquery","bui-common/1.1.0/common","bui-uploader/1.1.0/src/file","bui-uploader/1.1.0/src/button/base","bui-uploader/1.1.0/src/button/ajbridge","bui-uploader/1.1.0/src/button/filter","bui-swf/1.1.0/index"],function(e,t,r){function i(){return window.seajs?seajs.pluginSDK?seajs.pluginSDK.util.loaderDir:seajs.data.base:window.KISSY?KISSY.Config.packages.bui.base:void 0}var u=e("jquery"),n=e("bui-common/1.1.0/common"),a=(n.Component,e("bui-uploader/1.1.0/src/file")),o=e("bui-uploader/1.1.0/src/button/base"),s=i(),l=e("bui-uploader/1.1.0/src/button/ajbridge"),c=o.extend({renderUI:function(){var e=this;e._initSwfUploader()},bindUI:function(){var e=this,t=e.get("swfUploader");t.on("contentReady",function(){e.fire("swfReady",{swfUploader:t}),t.on("fileSelect",function(t){var r=t.fileList,i=[];n.each(r,function(e){i.push(a.create(e))}),e.fire("change",{files:i})})})},syncUI:function(){var e=this,t=e.get("swfUploader");t.on("contentReady",function(){e._uiSetMultiple(e.get("multiple")),e._uiSetFilter(e.get("filter"))})},_initSwfUploader:function(){var e,t=this,r=t.get("buttonCls"),i=t.get("el").find("."+r),a=t.get("flash"),o=t.get("flashUrl"),s=t.get("swfTpl"),c=u(s).appendTo(i);n.mix(a,{render:c,src:o}),e=new l(a),t.set("swfEl",c),t.set("swfUploader",e)},_uiSetMultiple:function(e){var t=this,r=t.get("swfUploader");return r&&r.multifile(e),e},_uiSetDisabled:function(e){var t=this,r=t.get("swfEl");return e?r.hide():r.show(),e},_convertFilter:function(e){var t=(e.desc,[]);return n.each(e.ext.split(","),function(e){e&&t.push("*"+e)}),e.ext=t.join(";"),e},_uiSetFilter:function(e){var t=this,r=t.get("swfUploader"),i=t._convertFilter(t.getFilter(e));return r&&r.filter([i]),e}},{ATTRS:{swfEl:{},swfUploader:{},flashUrl:{value:s+"uploader.swf"},flash:{value:{params:{allowscriptaccess:"always",bgcolor:"#fff",wmode:"transparent",flashvars:{hand:!0,btn:!0,jsEntry:"BUI.AJBridge.eventHandler"}}},shared:!1},swfTpl:{view:!0,value:'<div class="uploader-button-swf"></div>'}}},{xclass:"uploader-swfButton"});r.exports=c}),define("bui-uploader/1.1.0/src/type/ajax",["bui-uploader/1.1.0/src/type/base","jquery","bui-common/1.1.0/common"],function(e,t,r){function i(e){var t=this;i.superclass.constructor.call(t,e)}var u="[uploader-Ajax]:",n=e("bui-uploader/1.1.0/src/type/base");BUI.extend(i,n,{upload:function(e){if(!e||!e.file)return BUI.log(u+"upload()，fileData参数有误！"),!1;var t=this;return t.set("file",e),t.fire("start",{file:e}),t._setFormData(),t._addFileData(e.file),t.send(),t},cancel:function(){var e=this,t=e.get("xhr"),r=e.get("file");return t&&(t.abort(),e.fire("cancel",{file:r})),e.set("file",null),e},send:function(){var e=this,t=e.get("url"),r=e.get("formData"),i=e.get("file"),u=new XMLHttpRequest;return u.upload.addEventListener("progress",function(t){e.fire("progress",{loaded:t.loaded,total:t.total})}),u.onload=function(){var t=e._processResponse(u.responseText);e.fire("complete",{result:t,file:i})},u.onerror=function(){e.fire("error",{file:i})},u.open("POST",t,!0),u.send(r),e._setFormData(),e.set("xhr",u),e},reset:function(){},_setFormData:function(){var e=this;try{e.set("formData",new FormData),e._processData()}catch(t){BUI.log(u+"something error when reset FormData."),BUI.log(t,"dir")}},_processData:function(){var e=this,t=e.get("data"),r=e.get("formData");BUI.each(t,function(e,t){r.append(t,e)}),e.set("formData",r)},_addFileData:function(e){if(!e)return BUI.log(u+"_addFileData()，file参数有误！"),!1;var t=this,r=t.get("formData"),i=t.get("fileDataName");r.append(i,e),t.set("formData",r)}},{ATTRS:{formData:{},xhr:{},events:{value:{progress:!1}}}}),r.exports=i}),define("bui-uploader/1.1.0/src/type/flash",["jquery","bui-uploader/1.1.0/src/type/base","bui-common/1.1.0/common"],function(e,t,r){function i(e){var t=this;i.superclass.constructor.call(t,e)}var u=e("jquery"),n=e("bui-uploader/1.1.0/src/type/base"),a="[uploader-Flash]:",o=new RegExp("^([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),s=new RegExp("^(?:([\\w\\d+.-]+):)?(?://([\\w\\d\\-\\u0100-\\uffff.+%]*))?.*$");BUI.extend(i,n,{_initSwfUploader:function(){var e=this,t=e.get("swfUploader");return t?(e.fire("swfReady"),e._hasCrossdomain(),t.on("uploadStart",function(){var t=e.get("file");e.fire("start",{file:t})}),t.on("uploadProgress",function(t){BUI.mix(t,{loaded:t.bytesLoaded,total:t.bytesTotal}),BUI.log(a+"已经上传字节数为："+t.bytesLoaded),e.fire("progress",{loaded:t.loaded,total:t.total})}),t.on("uploadCompleteData",function(t){var r=e.get("file"),i=e._processResponse(t.data);e.fire("complete",{result:i,file:r}),e.set("file",null)}),void t.on("uploadError",function(){var t=e.get("file");e.fire("error",{file:t}),e.set("file",null)})):(BUI.log(a+"swfUploader对象为空！"),!1)},upload:function(e){var t=this,r=t.get("swfUploader"),i=t.get("url"),u="POST",n=t.get("data"),a=t.get("fileDataName");if(e)return t.set("file",e),r.upload(e.id,i,u,n,a),t},cancel:function(){var e=this,t=e.get("swfUploader"),r=e.get("file");return r&&(t.cancel(r.id),e.fire("cancel",{file:r}),e.set("file",null)),e},_hasCrossdomain:function(){var e=this,t=e.get("url").match(s)||[],r=e.get("swfUploader").get("src").match(s)||[],i=t[2],n=r[2];i&&n&&i!==n&&u.ajax({url:t[1]+"://"+i+"/crossdomain.xml",dataType:"xml",error:function(){BUI.log("缺少crossdomain.xml文件或该文件不合法！")}})}},{ATTRS:{uploader:{setter:function(e){var t=this;if(e&&e.isController){var r=e.get("button");r.on("swfReady",function(e){t.set("swfUploader",e.swfUploader),t._initSwfUploader()})}}},url:{setter:function(e){var t=/^http/;if(!t.test(e)){var r,i=location.href.match(o)||[],u=i[1]||"",n=u.split("/");r=BUI.Array.filter(n,function(e,t){return t<n.length-1}),e=r.join("/")+"/"+e}return e}},swfUploader:{},uploadingId:{},events:{value:{swfReady:!1,progress:!1}}}}),r.exports=i}),define("bui-uploader/1.1.0/src/type/iframe",["jquery","bui-uploader/1.1.0/src/type/base","bui-common/1.1.0/common"],function(e,t,r){function i(e){var t=this;i.superclass.constructor.call(t,e)}var u=e("jquery"),n=e("bui-uploader/1.1.0/src/type/base"),a="bui-uploader-iframe-";BUI.extend(i,n,{upload:function(e){var t,r=this,i=e.input;return e?(r.fire("start",{file:e}),r.set("file",e),r.set("fileInput",i),r._create(),t=r.get("form"),void(t&&t[0].submit())):!1},cancel:function(){{var e=this;e.get("iframe")}return e.reset(),e.fire("cancel"),e},dataToHidden:function(e){if(!u.isPlainObject(e)||u.isEmptyObject(e))return"";var t=this,r=[],i=t.get("tpl"),n=i.HIDDEN_INPUT;if(!BUI.isString(n))return"";for(var a in e)r.push(BUI.substitute(n,{name:a,value:e[a]}));return r.join()},_createIframe:function(){var e,t=this,r=a+BUI.guid(),i=t.get("tpl"),n=(i.IFRAME,t.get("iframe"));return u.isEmptyObject(n)?(e=u(BUI.substitute(i.IFRAME,{id:r})),u("body").append(e),e.on("load",function(e){t._iframeLoadHandler(e)}),t.set("id",r),t.set("iframe",e),e):n},_iframeLoadHandler:function(e){var t,r=this,i=e.target,u=i.contentDocument||window.frames[i.id].document;if(!u||!u.body)return r.fire("error",{msg:"服务器端返回数据有问题！"}),!1;var n=u.body.innerHTML;return""==n?void r.fire("error"):(t=r._processResponse(n),r.fire("complete",{result:t,file:r.get("file")}),void r.reset())},_createForm:function(){var e,t,r=this,i=r.get("id"),n=r.get("tpl"),a=n.FORM,o=r.get("data"),s=r.get("url"),l=r.get("fileInput");return BUI.isString(a)&&BUI.isString(s)?(e=r.dataToHidden(o),e+=r.dataToHidden({type:"iframe"}),t=BUI.substitute(a,{action:s,target:i,hiddenInputs:e}),t=u(t).append(l),u("body").append(t),r.set("form",t),t):!1},_create:function(){var e=this,t=e._createIframe(),r=e._createForm();e.fire("create",{iframe:t,form:r})},_remove:function(){var e=this,t=e.get("form");return t?(t.remove(),e.set("form",null),void e.fire("remove",{form:t})):!1},reset:function(){var e=this;e._remove(),e.set("file",null)}},{ATTRS:{tpl:{value:{IFRAME:'<iframe src="javascript:false;" name="{id}" id="{id}" border="no" width="1" height="1" style="display: none;" />',FORM:'<form method="post" enctype="multipart/form-data" action="{action}" target="{target}" style="visibility: hidden;">{hiddenInputs}</form>',HIDDEN_INPUT:'<input type="hidden" name="{name}" value="{value}" />'}},id:{value:a+BUI.guid()},iframe:{value:{}},form:{},fileInput:{},events:{value:{create:!1,remove:!1}}}}),r.exports=i}),define("bui-uploader/1.1.0/src/button/base",["jquery","bui-common/1.1.0/common","bui-uploader/1.1.0/src/button/filter"],function(e,t,r){var i=e("bui-common/1.1.0/common"),u=i.Component,n=e("bui-uploader/1.1.0/src/button/filter"),a=i.prefix,o=a+"uploader",s=o+"-button",l=s+"-text",c=u.View.extend({_uiSetText:function(){var e=this,t=e.get("text"),r=e.get("textCls"),i=e.get("el").find("."+r);i.text(t)}},{ATTRS:{}},{xclass:"uploader-button-view"}),d=u.Controller.extend({getFilter:function(e){if(e){var t=[],r=[],i=[];return e.desc&&(t.push(e.desc),r.push(n.getExtByDesc(e.desc)),i.push(n.getTypeByDesc(e.desc))),e.ext&&(r.push(e.ext),i.push(n.getTypeByExt(e.ext))),e.type,{desc:t.join(","),ext:r.join(","),type:i.join(",")}}}},{ATTRS:{buttonCls:{value:s+"-wrap",view:!0},textCls:{value:l,view:!0},text:{view:!0,value:"上传文件"},name:{value:"fileData"},tpl:{view:!0,value:'<a href="javascript:void(0);" class="'+s+'-wrap"><span class="'+l+'">{text}</span></a>'},disabled:{value:!1},multiple:{value:!0},filter:{shared:!1,value:[]},events:{value:{change:!1}},xview:{value:c}}},{xclass:"uploader-button"});d.View=c,r.exports=d}),define("bui-uploader/1.1.0/src/button/filter",["jquery","bui-common/1.1.0/common"],function(e,t,r){var i=e("bui-common/1.1.0/common"),u={msexcel:{type:"application/msexcel",ext:".xls,.xlsx"},msword:{type:"application/msword",ext:".doc,.docx"},gif:{type:"image/gif",ext:".gif"},jpeg:{type:"image/jpeg",ext:".jpg"},bmp:{type:"image/x-ms-bmp",ext:".bmp"},png:{type:"image/png",ext:".png"}};r.exports={_getValueByDesc:function(e,t){var r=[];return i.isString(e)&&(e=e.split(",")),i.isArray(e)&&i.each(e,function(e){var i=u[e];i&&i[t]&&r.push(i[t])}),r.join(",")},getTypeByDesc:function(e){return this._getValueByDesc(e,"type")},getExtByDesc:function(e){return this._getValueByDesc(e,"ext")},getTypeByExt:function(e){var t=[];return i.isString(e)&&(e=e.split(",")),i.isArray(e)&&i.each(e,function(e){i.each(u,function(r){i.Array.indexOf(e,r.ext.split(","))>-1&&t.push(r.type)})}),t.join(",")}}}),define("bui-uploader/1.1.0/src/button/ajbridge",["jquery","bui-common/1.1.0/common","bui-swf/1.1.0/index"],function(e,t,r){function i(e){i.superclass.constructor.call(this,e)}var u=e("bui-common/1.1.0/common"),n=e("bui-swf/1.1.0/index"),a={};u.mix(i,{eventHandler:function(e,t){var r=a[e];r&&r.__eventHandler(e,t)},augment:function(e,t){u.isString(t)&&(t=[t]),u.isArray(t)&&u.each(t,function(t){e.prototype[t]=function(){try{return this.callSWF(t,Array.prototype.slice.call(arguments,0))}catch(e){this.fire("error",{message:e})}}})}}),u.extend(i,n),u.augment(i,{initializer:function(){i.superclass.initializer.call(this);var e=this,t=e.get("attrs"),r=t.id;a[r]=e,e.set("id",r)},__eventHandler:function(e,t){var r=this,i=t.type;switch(t.id=e,i){case"log":u.log(t.message);break;default:r.fire(i,t)}},destroy:function(){i.superclass.destroy.call(this);var e=this.get("id");a[e]&&delete a[e]}}),i.augment(i,["activate","getReady","getCoreVersion","setFileFilters","filter","setAllowMultipleFiles","multifile","browse","upload","uploadAll","cancel","getFile","removeFile","lock","unlock","setBtnMode","useHand","clear"]),u.AJBridge=i,r.exports=i}),define("bui-uploader/1.1.0/src/type/base",["jquery","bui-common/1.1.0/common"],function(e,t,r){function i(e){var t=this;i.superclass.constructor.call(t,e)}var u=e("bui-common/1.1.0/common");i.ATTRS={file:{},url:{},data:{},fileDataName:{value:"Filedata"},events:{value:{start:!1,cancel:!1,success:!1,error:!1}}},u.extend(i,u.Base,{upload:function(){},cancel:function(){},_processResponse:function(e){{var t,r=this;r.get("file")}if(u.isString(e))try{t=u.JSON.parse(e)}catch(i){t=e}else u.isObject(e)&&(t=r._fromUnicode(e));return u.log("服务器端输出："+u.JSON.stringify(t)),t},_fromUnicode:function(e){function t(e){u.each(e,function(r,i){u.isObject(e[i])?t(e[i]):e[i]=u.isString(r)&&u.fromUnicode(r)||r})}return u.isObject(e)?(t(e),e):e},reset:function(){}}),r.exports=i});